<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Kidney Disease Classification</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
		integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<style>
		body {
			background-color: #f4f6fb;
			font-family: 'Segoe UI', sans-serif;
		}

		.header {
			background: #1b2d6b;
			color: #fff;
			padding: 24px 0;
			margin-bottom: 30px;
		}

		.header h2 {
			margin: 0;
			font-weight: 700;
		}

		.card {
			border: none;
			border-radius: 12px;
			box-shadow: 0 2px 12px rgba(0, 0, 0, .08);
		}

		.preview-box {
			width: 300px;
			height: 300px;
			border: 2px dashed #adb5bd;
			border-radius: 8px;
			display: flex;
			align-items: center;
			justify-content: center;
			margin: 0 auto;
			overflow: hidden;
			background: #fff;
			cursor: pointer;
			transition: border-color 0.2s, background-color 0.2s;
		}

		.preview-box.dragover {
			border-color: #1b2d6b;
			background-color: #e8ecf8;
		}

		.preview-box img {
			max-width: 100%;
			max-height: 100%;
			display: none;
		}

		.preview-box .placeholder {
			color: #6c757d;
			text-align: center;
		}

		.result-box {
			min-height: 120px;
			border: 1px solid #dee2e6;
			border-radius: 8px;
			padding: 20px;
			background: #fff;
		}

		.result-box h4 {
			color: #1b2d6b;
		}

		.result-label {
			font-size: 2rem;
			font-weight: 700;
		}

		.result-label.normal {
			color: #28a745;
		}

		.result-label.tumor {
			color: #dc3545;
		}

		.result-label.cyst {
			color: #fd7e14;
		}

		.result-label.stone {
			color: #6f42c1;
		}

		#loading {
			position: fixed;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			z-index: 9999;
			background: rgba(255, 255, 255, .75);
			display: none;
		}

		.spinner {
			border: 6px solid #e9ecef;
			border-top: 6px solid #1b2d6b;
			border-radius: 50%;
			width: 50px;
			height: 50px;
			animation: spin 1s linear infinite;
			position: absolute;
			top: 50%;
			left: 50%;
			margin: -25px 0 0 -25px;
		}

		@keyframes spin {
			0% {
				transform: rotate(0)
			}

			100% {
				transform: rotate(360deg)
			}
		}
	</style>
</head>

<body>

	<div class="header text-center">
		<h2>Kidney Disease Classification</h2>
		<small>Upload a CT scan image to classify as Normal, Cyst, Tumor, or Stone</small>
	</div>

	<div class="container">
		<div class="row justify-content-center">
			<!-- Upload -->
			<div class="col-md-5 mb-4">
				<div class="card p-4 text-center">
					<h5 class="mb-3">CT Scan Image</h5>
					<div class="preview-box" id="previewBox">
						<img src="" id="photo" alt="Preview">
						<div class="placeholder" id="placeholderText">
							<p>Click or drag to upload</p>
							<small class="text-muted">JPG / PNG</small>
						</div>
					</div>
					<input type="file" id="fileinput" accept="image/*" style="display:none;">
					<div class="mt-3">
						<button class="btn btn-primary mr-2" id="uload">Upload Image</button>
						<button class="btn btn-success" id="send">Predict</button>
					</div>
				</div>
			</div>

			<!-- Result -->
			<div class="col-md-5 mb-4">
				<div class="card p-4">
					<h5 class="mb-3 text-center">Prediction Result</h5>
					<div class="result-box text-center" id="resultBox">
						<p class="text-muted" id="resultPlaceholder">Upload an image and click Predict</p>
						<div id="resultContent" style="display:none;">
							<p class="mb-1">Classification:</p>
							<p class="result-label" id="resultLabel"></p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div id="loading">
		<div class="spinner"></div>
	</div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script>
		var base_data = "";

		$('#uload').click(function () { $('#fileinput').click(); });

		$('#previewBox').click(function () { $('#fileinput').click(); });

		// Drag-and-drop support
		var box = document.getElementById('previewBox');
		box.addEventListener('dragover', function (e) {
			e.preventDefault();
			e.stopPropagation();
			box.classList.add('dragover');
		});
		box.addEventListener('dragleave', function (e) {
			e.preventDefault();
			e.stopPropagation();
			box.classList.remove('dragover');
		});
		box.addEventListener('drop', function (e) {
			e.preventDefault();
			e.stopPropagation();
			box.classList.remove('dragover');
			if (e.dataTransfer.files && e.dataTransfer.files[0]) {
				$('#fileinput')[0].files = e.dataTransfer.files;
				$('#fileinput').trigger('change');
			}
		});

		$('#fileinput').change(function () {
			if (this.files && this.files[0]) {
				var reader = new FileReader();
				reader.onload = function (e) {
					var url = e.target.result;
					var img = new Image();
					img.crossOrigin = 'Anonymous';
					img.onload = function () {
						var canvas = document.createElement('canvas');
						canvas.width = this.width;
						canvas.height = this.height;
						canvas.getContext('2d').drawImage(this, 0, 0);
						base_data = canvas.toDataURL('image/jpeg', 1.0).replace(/^data:image.+;base64,/, '');
					};
					img.src = url;
					$('#photo').attr('src', url).show();
					$('#placeholderText').hide();
				};
				reader.readAsDataURL(this.files[0]);
			}
		});

		$('#send').click(function () {
			if (!base_data) { alert('Please upload an image first.'); return; }
			$('#loading').show();
			$.ajax({
				url: '/predict',
				type: 'POST',
				contentType: 'application/json',
				data: JSON.stringify({ image: base_data }),
				success: function (res) {
					var label = res[0].image;
					$('#resultLabel').text(label)
						.removeClass('normal tumor cyst stone')
						.addClass(label.toLowerCase());
					$('#resultPlaceholder').hide();
					$('#resultContent').show();
					$('#loading').hide();
				},
				error: function () {
					alert('Prediction failed. Make sure the server is running.');
					$('#loading').hide();
				}
			});
		});
	</script>
</body>

</html>